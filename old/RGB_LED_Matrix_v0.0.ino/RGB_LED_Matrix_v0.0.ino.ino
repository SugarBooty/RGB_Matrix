/* Pinout:
 *  d2 - 4017 reset
 *  d3 - 4017 clock
 *  
 *  d5 - shift clock
 *  d6 - shift clear
 *  d7 - shift ser in
 * 
 *  d9 - blank
 */

#define a4017_RST 2
#define a4017_CLK 3
#define SHIFT_CLK 5
#define SHIFT_CLR 6
#define SHIFT_SER 7

unsigned long prevMillis = 0;
const long shiftDelay = 10;

int row;
int col;
int x;
int y = 0;
int value;

bool blank[8][24] = {
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
};

bool white[8][24] = {
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
  {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
};

bool red[8][15] = {
  {1,0,0,1,0,0,1,0,0,1,0,0,1,0,0},
  {1,0,0,1,0,0,1,0,0,1,0,0,1,0,0},
  {1,0,0,1,0,0,1,0,0,1,0,0,1,0,0},
  {1,0,0,1,0,0,1,0,0,1,0,0,1,0,0},
  {1,0,0,1,0,0,1,0,0,1,0,0,1,0,0},
  {1,0,0,1,0,0,1,0,0,1,0,0,1,0,0},
  {1,0,0,1,0,0,1,0,0,1,0,0,1,0,0},
  {1,0,0,1,0,0,1,0,0,1,0,0,1,0,0},
};

bool green[8][15] = {
  {0,1,0,0,1,0,0,1,0,0,1,0,0,1,0},
  {0,1,0,0,1,0,0,1,0,0,1,0,0,1,0},
  {0,1,0,0,1,0,0,1,0,0,1,0,0,1,0},
  {0,1,0,0,1,0,0,1,0,0,1,0,0,1,0},
  {0,1,0,0,1,0,0,1,0,0,1,0,0,1,0},
  {0,1,0,0,1,0,0,1,0,0,1,0,0,1,0},
  {0,1,0,0,1,0,0,1,0,0,1,0,0,1,0},
  {0,1,0,0,1,0,0,1,0,0,1,0,0,1,0},
};

bool blue[8][15] = {
  {0,0,1,0,0,1,0,0,1,0,0,1,0,0,1},
  {0,0,1,0,0,1,0,0,1,0,0,1,0,0,1},
  {0,0,1,0,0,1,0,0,1,0,0,1,0,0,1},
  {0,0,1,0,0,1,0,0,1,0,0,1,0,0,1},
  {0,0,1,0,0,1,0,0,1,0,0,1,0,0,1},
  {0,0,1,0,0,1,0,0,1,0,0,1,0,0,1},
  {0,0,1,0,0,1,0,0,1,0,0,1,0,0,1},
  {0,0,1,0,0,1,0,0,1,0,0,1,0,0,1},
};

void setup() {
  pinMode(2, OUTPUT);
  pinMode(3, OUTPUT);
  pinMode(5, OUTPUT);
  pinMode(6, OUTPUT);
  pinMode(7, OUTPUT);
  pinMode(9, OUTPUT);
  
  digitalWrite(a4017_RST, HIGH);
  delay(10);
  digitalWrite(a4017_RST, LOW);

  digitalWrite(9, HIGH);
}

void loop() {
  clearReg();

  for (row=0;row<8;row++) {
    for (col=0;col<24;col++) {
      
      ShiftOut((white[row][col]));
     }
    digitalWrite(9, 1);
    delayMicroseconds(100);
    digitalWrite(9, LOW);
    nextRow();
  }



}

void nextRow() {
  digitalWrite(a4017_CLK, HIGH);
  digitalWrite(a4017_CLK, LOW);
}

void ShiftOut(int value) {
  digitalWrite(SHIFT_CLK, LOW);
  digitalWrite(SHIFT_SER, !value);
  digitalWrite(SHIFT_CLK, HIGH);
}

void clearReg() {
  digitalWrite(SHIFT_CLR, LOW);
  digitalWrite(SHIFT_CLR, HIGH);
}
